<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ì†Œ ê²€ìƒ‰ - Config íŒŒì¼ ì‚¬ìš©</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', -apple-system, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .search-box {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .search-input {
      flex: 1;
      padding: 12px 16px;
      font-size: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      outline: none;
    }

    .search-input:focus {
      border-color: #4a90e2;
    }

    .search-btn {
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      color: white;
      background-color: #4a90e2;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .search-btn:hover {
      background-color: #357abd;
    }

    .results {
      position: relative;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 12px;
      display: none;
    }

    .results.show {
      display: block;
    }

    .result-item {
      padding: 16px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
    }

    .result-item:hover {
      background-color: #f8f9fa;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-type {
      display: inline-block;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 600;
      color: white;
      background-color: #4a90e2;
      border-radius: 4px;
      margin-right: 8px;
    }

    .result-address {
      font-size: 14px;
      color: #333;
    }

    .result-zipcode {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .selected-address {
      margin-top: 20px;
      padding: 16px;
      background-color: #f0f8ff;
      border: 1px solid #4a90e2;
      border-radius: 8px;
      display: none;
    }

    .selected-address.show {
      display: block;
    }

    .selected-address h3 {
      color: #4a90e2;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .selected-address p {
      margin: 5px 0;
      font-size: 14px;
    }

    .info-box {
      background-color: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.6;
    }

    .warning-box {
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.6;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .error {
      text-align: center;
      padding: 20px;
      color: #e74c3c;
    }

    .api-key-display {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      margin-top: 10px;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ  í•œêµ­ ì£¼ì†Œ ê²€ìƒ‰</h1>
    <p class="subtitle">ì„¤ì • íŒŒì¼(config.js)ì—ì„œ API í‚¤ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤</p>

    <div class="warning-box">
      <strong>âš™ï¸ API í‚¤ ì„¤ì •:</strong><br>
      í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ API í‚¤: <span id="apiKeyStatus">í™•ì¸ ì¤‘...</span>
      <div class="api-key-display" id="apiKeyDisplay"></div>
    </div>

    <div class="info-box">
      <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
      1. ì•„ë˜ ê²€ìƒ‰ì°½ì— ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íŒêµì—­ë¡œ 235)<br>
      2. ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì—”í„°ë¥¼ ëˆ„ë¥´ì„¸ìš”<br>
      3. ëª©ë¡ì—ì„œ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ í´ë¦­í•˜ì„¸ìš”
    </div>

    <div class="search-box">
      <input type="text" class="search-input" id="searchInput" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      <button class="search-btn" id="searchBtn">ê²€ìƒ‰</button>
    </div>

    <div class="results" id="results"></div>

    <div class="selected-address" id="selectedAddress">
      <h3>âœ… ì„ íƒëœ ì£¼ì†Œ</h3>
      <p><strong>ìš°í¸ë²ˆí˜¸:</strong> <span id="zipcode"></span></p>
      <p><strong>ë„ë¡œëª… ì£¼ì†Œ:</strong> <span id="roadAddress"></span></p>
      <p><strong>ì§€ë²ˆ ì£¼ì†Œ:</strong> <span id="jibunAddress"></span></p>
    </div>
  </div>

  <script type="module">
    // config.jsì—ì„œ API í‚¤ ë¡œë“œ ì‹œë„
    let API_KEY = 'devU01TX0FVVEgyMDI1MDExMDE1MTY0MTExNTM2MjY='; // ê¸°ë³¸ í…ŒìŠ¤íŠ¸ í‚¤

    try {
      const configModule = await import('./config.js');
      if (configModule.config && configModule.config.jusoApiKey) {
        API_KEY = configModule.config.jusoApiKey;
        document.getElementById('apiKeyStatus').textContent = 'âœ… config.jsì—ì„œ ë¡œë“œë¨';
        document.getElementById('apiKeyDisplay').textContent = API_KEY.substring(0, 20) + '...';
        console.log('âœ… config.jsì—ì„œ API í‚¤ ë¡œë“œ ì„±ê³µ');
      }
    } catch (error) {
      console.warn('âš ï¸ config.js íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
      document.getElementById('apiKeyStatus').textContent = 'âš ï¸ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ í‚¤ ì‚¬ìš© ì¤‘';
      document.getElementById('apiKeyDisplay').textContent = API_KEY.substring(0, 20) + '... (í…ŒìŠ¤íŠ¸ìš©)';
    }

    const API_URL = 'https://business.juso.go.kr/addrlink/addrLinkApi.do';
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const resultsDiv = document.getElementById('results');
    const selectedAddressDiv = document.getElementById('selectedAddress');

    // ê²€ìƒ‰ í•¨ìˆ˜
    async function searchAddress(keyword) {
      if (!keyword || keyword.trim().length === 0) {
        alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      resultsDiv.innerHTML = '<div class="loading">ê²€ìƒ‰ ì¤‘...</div>';
      resultsDiv.classList.add('show');

      try {
        const params = new URLSearchParams({
          confmKey: API_KEY,
          currentPage: '1',
          countPerPage: '10',
          keyword: keyword.trim(),
          resultType: 'json'
        });

        const response = await fetch(`${API_URL}?${params.toString()}`);
        const data = await response.json();

        console.log('API ì‘ë‹µ:', data);

        if (data.results.common.errorCode !== '0') {
          resultsDiv.innerHTML = `<div class="error">
            <strong>ê²€ìƒ‰ ì˜¤ë¥˜:</strong><br>
            ${data.results.common.errorMessage}<br><br>
            <small>API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”. config.js íŒŒì¼ì— ì˜¬ë°”ë¥¸ í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</small>
          </div>`;
          return;
        }

        displayResults(data.results.juso);

      } catch (error) {
        console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        resultsDiv.innerHTML = '<div class="error">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
      }
    }

    // ê²°ê³¼ í‘œì‹œ
    function displayResults(addresses) {
      if (!addresses || addresses.length === 0) {
        resultsDiv.innerHTML = '<div class="error">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      let html = '';
      addresses.forEach((addr, index) => {
        html += `
          <div class="result-item" data-index="${index}">
            <div>
              <span class="result-type">ë„ë¡œëª…</span>
              <span class="result-address">${addr.roadAddr}</span>
            </div>
            <div style="margin-top: 4px;">
              <span class="result-type" style="background-color: #999;">ì§€ë²ˆ</span>
              <span class="result-address">${addr.jibunAddr}</span>
            </div>
            <div class="result-zipcode">ìš°í¸ë²ˆí˜¸: ${addr.zipNo}</div>
          </div>
        `;
      });

      resultsDiv.innerHTML = html;

      // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
      resultsDiv.querySelectorAll('.result-item').forEach((item, index) => {
        item.addEventListener('click', () => selectAddress(addresses[index]));
      });
    }

    // ì£¼ì†Œ ì„ íƒ
    function selectAddress(addr) {
      console.log('ì„ íƒëœ ì£¼ì†Œ:', addr);

      document.getElementById('zipcode').textContent = addr.zipNo;
      document.getElementById('roadAddress').textContent = addr.roadAddr;
      document.getElementById('jibunAddress').textContent = addr.jibunAddr;

      selectedAddressDiv.classList.add('show');
      resultsDiv.classList.remove('show');

      selectedAddressDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    searchBtn.addEventListener('click', () => {
      searchAddress(searchInput.value);
    });

    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchAddress(searchInput.value);
      }
    });

    console.log('âœ… ì£¼ì†Œ ê²€ìƒ‰ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
    console.log('ğŸ“Œ ì‚¬ìš© ì¤‘ì¸ API í‚¤:', API_KEY.substring(0, 20) + '...');
  </script>
</body>
</html>
