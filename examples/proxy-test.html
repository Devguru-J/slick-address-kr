<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ì†Œ ê²€ìƒ‰ - ë°±ì—”ë“œ í”„ë¡ì‹œ ì‚¬ìš©</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', -apple-system, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .info-box {
      background-color: #e8f5e9;
      border: 1px solid #4caf50;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.6;
    }

    .search-box {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .search-input {
      flex: 1;
      padding: 12px 16px;
      font-size: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      outline: none;
    }

    .search-input:focus {
      border-color: #4caf50;
    }

    .search-btn {
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      color: white;
      background-color: #4caf50;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .search-btn:hover {
      background-color: #45a049;
    }

    .results {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 12px;
      display: none;
    }

    .results.show {
      display: block;
    }

    .result-item {
      padding: 16px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
    }

    .result-item:hover {
      background-color: #f1f8e9;
    }

    .result-item.active {
      background-color: #e8f5e9;
      border-left: 3px solid #4caf50;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-type {
      display: inline-block;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 600;
      color: white;
      background-color: #4caf50;
      border-radius: 4px;
      margin-right: 8px;
    }

    .result-address {
      font-size: 14px;
      color: #333;
    }

    .result-zipcode {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .selected-address {
      margin-top: 20px;
      padding: 16px;
      background-color: #f1f8e9;
      border: 1px solid #4caf50;
      border-radius: 8px;
      display: none;
    }

    .selected-address.show {
      display: block;
    }

    .selected-address h3 {
      color: #4caf50;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .selected-address p {
      margin: 5px 0;
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .error {
      text-align: center;
      padding: 20px;
      color: #e74c3c;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ  í•œêµ­ ì£¼ì†Œ ê²€ìƒ‰</h1>
    <p class="subtitle">ë°±ì—”ë“œ í”„ë¡ì‹œ ì„œë²„ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ API í˜¸ì¶œ</p>

    <div class="info-box">
      <strong>âœ… ë°±ì—”ë“œ í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš© ì¤‘</strong><br>
      API í‚¤ê°€ ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë©ë‹ˆë‹¤.<br>
      ë„ë©”ì¸ ì œí•œ ì—†ì´ localhostì—ì„œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤!<br><br>
      <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
      1. ì•„ë˜ ê²€ìƒ‰ì°½ì— ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íŒêµì—­ë¡œ 235)<br>
      2. íƒ€ì´í•‘í•˜ë©´ ìë™ìœ¼ë¡œ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤<br>
      3. <strong>â¬†ï¸â¬‡ï¸ í™”ì‚´í‘œ í‚¤</strong>ë¡œ ê²°ê³¼ë¥¼ ì„ íƒí•˜ê³  <strong>Enter</strong>ë¡œ ì ìš©í•˜ì„¸ìš”<br>
      4. ë˜ëŠ” ë§ˆìš°ìŠ¤ë¡œ í´ë¦­í•´ë„ ë©ë‹ˆë‹¤
    </div>

    <div class="search-box">
      <input type="text" class="search-input" id="searchInput" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
      <button class="search-btn" id="searchBtn">ê²€ìƒ‰</button>
    </div>

    <div class="results" id="results"></div>

    <div class="selected-address" id="selectedAddress">
      <h3>âœ… ì„ íƒëœ ì£¼ì†Œ</h3>
      <p><strong>ìš°í¸ë²ˆí˜¸:</strong> <span id="zipcode"></span></p>
      <p><strong>ë„ë¡œëª… ì£¼ì†Œ:</strong> <span id="roadAddress"></span></p>
      <p><strong>ì§€ë²ˆ ì£¼ì†Œ:</strong> <span id="jibunAddress"></span></p>
    </div>
  </div>

  <script>
    // ë°±ì—”ë“œ í”„ë¡ì‹œ ì„œë²„ URL
    const API_URL = 'http://localhost:3001/api/address/search';

    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const resultsDiv = document.getElementById('results');
    const selectedAddressDiv = document.getElementById('selectedAddress');

    // ë””ë°”ìš´ì‹± íƒ€ì´ë¨¸
    let debounceTimer = null;

    // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ì„ ìœ„í•œ ë³€ìˆ˜
    let currentAddresses = [];
    let selectedIndex = -1;

    // ê²€ìƒ‰ í•¨ìˆ˜
    async function searchAddress(keyword, isAutocomplete = false) {
      // ìë™ì™„ì„± ëª¨ë“œì—ì„œëŠ” ìµœì†Œ 2ê¸€ì í•„ìš”
      if (isAutocomplete && keyword.trim().length < 2) {
        resultsDiv.classList.remove('show');
        return;
      }

      if (!keyword || keyword.trim().length === 0) {
        if (!isAutocomplete) {
          alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        }
        return;
      }

      resultsDiv.innerHTML = '<div class="loading">ê²€ìƒ‰ ì¤‘...</div>';
      resultsDiv.classList.add('show');

      try {
        const params = new URLSearchParams({
          keyword: keyword.trim(),
          currentPage: '1',
          countPerPage: '10'
        });

        const response = await fetch(`${API_URL}?${params.toString()}`);
        const data = await response.json();

        console.log('API ì‘ë‹µ:', data);

        // ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
        if (data.error) {
          resultsDiv.innerHTML = `<div class="error">
            <strong>ê²€ìƒ‰ ì˜¤ë¥˜:</strong><br>
            ${data.error}
          </div>`;
          return;
        }

        // API ì—ëŸ¬ ì²´í¬
        if (data.results.common.errorCode !== '0') {
          resultsDiv.innerHTML = `<div class="error">
            <strong>ê²€ìƒ‰ ì˜¤ë¥˜:</strong><br>
            ${data.results.common.errorMessage}
          </div>`;
          return;
        }

        displayResults(data.results.juso);

      } catch (error) {
        console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        resultsDiv.innerHTML = '<div class="error">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ë°±ì—”ë“œ í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.</div>';
      }
    }

    // ê²°ê³¼ í‘œì‹œ
    function displayResults(addresses) {
      if (!addresses || addresses.length === 0) {
        resultsDiv.innerHTML = '<div class="error">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        currentAddresses = [];
        selectedIndex = -1;
        return;
      }

      // í˜„ì¬ ì£¼ì†Œ ëª©ë¡ ì €ì¥ (í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ìš©)
      currentAddresses = addresses;
      selectedIndex = -1;

      let html = '';
      addresses.forEach((addr, index) => {
        html += `
          <div class="result-item" data-index="${index}">
            <div>
              <span class="result-type">ë„ë¡œëª…</span>
              <span class="result-address">${addr.roadAddr}</span>
            </div>
            <div style="margin-top: 4px;">
              <span class="result-type" style="background-color: #999;">ì§€ë²ˆ</span>
              <span class="result-address">${addr.jibunAddr}</span>
            </div>
            <div class="result-zipcode">ìš°í¸ë²ˆí˜¸: ${addr.zipNo}</div>
          </div>
        `;
      });

      resultsDiv.innerHTML = html;

      // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
      resultsDiv.querySelectorAll('.result-item').forEach((item, index) => {
        item.addEventListener('click', () => selectAddress(addresses[index]));
      });
    }

    // í‚¤ë³´ë“œë¡œ ì„ íƒëœ í•­ëª© í•˜ì´ë¼ì´íŠ¸
    function updateSelection() {
      const items = resultsDiv.querySelectorAll('.result-item');
      items.forEach((item, index) => {
        if (index === selectedIndex) {
          item.classList.add('active');
          item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
          item.classList.remove('active');
        }
      });
    }

    // í™”ì‚´í‘œ í‚¤ë¡œ ì„ íƒ ì´ë™
    function moveSelection(direction) {
      if (currentAddresses.length === 0) return;

      if (direction === 'down') {
        selectedIndex = Math.min(selectedIndex + 1, currentAddresses.length - 1);
      } else if (direction === 'up') {
        selectedIndex = Math.max(selectedIndex - 1, -1);
      }

      updateSelection();
    }

    // í˜„ì¬ ì„ íƒëœ í•­ëª© ì ìš©
    function applySelection() {
      if (selectedIndex >= 0 && selectedIndex < currentAddresses.length) {
        selectAddress(currentAddresses[selectedIndex]);
      }
    }

    // ì£¼ì†Œ ì„ íƒ
    function selectAddress(addr) {
      console.log('ì„ íƒëœ ì£¼ì†Œ:', addr);

      document.getElementById('zipcode').textContent = addr.zipNo;
      document.getElementById('roadAddress').textContent = addr.roadAddr;
      document.getElementById('jibunAddress').textContent = addr.jibunAddr;

      selectedAddressDiv.classList.add('show');
      resultsDiv.classList.remove('show');

      selectedAddressDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    searchBtn.addEventListener('click', () => {
      searchAddress(searchInput.value);
    });

    // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (í™”ì‚´í‘œ í‚¤, ì—”í„°)
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        moveSelection('down');
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        moveSelection('up');
      } else if (e.key === 'Enter') {
        e.preventDefault();
        // ì„ íƒëœ í•­ëª©ì´ ìˆìœ¼ë©´ ì ìš©, ì—†ìœ¼ë©´ ê²€ìƒ‰
        if (selectedIndex >= 0) {
          applySelection();
        } else {
          searchAddress(searchInput.value);
        }
      } else if (e.key === 'Escape') {
        // ESC í‚¤ë¡œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        resultsDiv.classList.remove('show');
        selectedIndex = -1;
      }
    });

    // ìë™ì™„ì„±: íƒ€ì´í•‘í•  ë•Œë§ˆë‹¤ ì‹¤ì‹œê°„ ê²€ìƒ‰ (ë””ë°”ìš´ì‹± 300ms)
    searchInput.addEventListener('input', (e) => {
      const keyword = e.target.value;

      // ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ
      if (debounceTimer) {
        clearTimeout(debounceTimer);
      }

      // ì…ë ¥ì´ ë¹„ì–´ìˆìœ¼ë©´ ê²°ê³¼ ìˆ¨ê¹€
      if (keyword.trim().length === 0) {
        resultsDiv.classList.remove('show');
        return;
      }

      // 300ms í›„ ìë™ ê²€ìƒ‰
      debounceTimer = setTimeout(() => {
        searchAddress(keyword, true);
      }, 300);
    });

    console.log('âœ… ì£¼ì†Œ ê²€ìƒ‰ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
    console.log('ğŸ“Œ í”„ë¡ì‹œ ì„œë²„ URL:', API_URL);
    console.log('âš¡ ìë™ì™„ì„± ëª¨ë“œ: í™œì„±í™” (2ê¸€ì ì´ìƒ ì…ë ¥ ì‹œ ìë™ ê²€ìƒ‰)');
    console.log('âŒ¨ï¸  í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜: â†‘â†“ í™”ì‚´í‘œ í‚¤ë¡œ ì„ íƒ, Enterë¡œ ì ìš©, ESCë¡œ ë‹«ê¸°');
  </script>
</body>
</html>
